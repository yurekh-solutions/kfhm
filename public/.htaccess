# Enable mod_rewrite for URL rewriting
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Prevent infinite loops
  RewriteCond %{ENV:REDIRECT_STATUS} 200
  RewriteRule ^ - [L]
  
  # Protect sensitive files
  RewriteRule ^\. - [F,L]
  RewriteRule \.(env|json)$ - [F,L]
  
  # Don't rewrite if it's an existing file
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]
  
  # Don't rewrite if it's an existing directory
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # Remove trailing slashes from non-directory URLs
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.+)/$ /$1 [R=301,L]
  
  # Rewrite all requests to index.html for SPA routing
  RewriteCond %{REQUEST_URI} !^/assets/
  RewriteCond %{REQUEST_URI} !^/api/
  RewriteRule ^(.*)$ index.html [QSA,L]
</IfModule>

# Proper MIME types
<IfModule mod_mime.c>
  AddType text/css .css
  AddType text/javascript .js
  AddType application/javascript .js
  AddType application/x-javascript .js
  AddType image/svg+xml .svg
  AddType application/font-woff .woff
  AddType application/font-woff2 .woff2
  AddType application/vnd.ms-fontobject .eot
  AddType application/x-font-ttf .ttf
  AddEncoding gzip .gz
  AddType text/plain .log
</IfModule>

# Enable GZIP compression
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE application/json
</IfModule>

# Security headers
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Cache-Control headers for static assets
<FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot|webp)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# Cache-Control headers for HTML files
<FilesMatch "\.(html|htm)$">
  Header set Cache-Control "public, max-age=3600, must-revalidate"
</FilesMatch>
